# Использование бота

## Создание бота в BotFather

Перед тем, как запускать приложение бота, необходимо создать сам аккаунт бота в Telegram. Для этого необходимо:

1. Начать диалог с ботом [@BotFather](https://t.me/BotFather)
2. Выбрать отображаемое название бота
3. Выбрать username бота. Он должен заканчиваться словом "bot"
4. Сохранить полученный от BotFather токен. Он понадобится для запуска бота
5. Отправить в BotFather команду `/mybots` (или выбрать её в меню)
6. Выбрать созданного бота
7. Зайти в `Bot Settings`
8. Зайти в `Allow Groups?`. Отключить возможность боту находиться в группах (`Turn groups off`) и перейти обратно в
   настройки (`Back to Settings`)
9. Зайти в `Menu button` и нажать `Configure menu button`
10. Отправить URL редактора конфигураций (`logbot-web`). Адрес должен включать в себя HTTPS
11. Отправить отображаемый на кнопке текст (например, слово `Редактор`)
12. Перейти обратно в настройки (`Back to Settings`). Выбрать `Configure Mini App` - `Edit Mini App URL`
13. Отправить URL редактора конфигураций (`logbot-web`). Как и на шаге 10, адрес должен включать в себя HTTPS

## Конфигурация запуска

Для запуска бота необходимо определить следующие переменные (указаны
в [application.yaml](src/main/resources/application.yaml)):

* bot.webhook-path - URL хоста бота. Необходим Telegram для отправки боту новых сообщений
* bot.username - юзернейм бота, выданный [@BotFather](https://t.me/BotFather)
* bot.token - токен бота, выданный [@BotFather](https://t.me/BotFather)

## Запуск

После проделанных в предыдущих разделах действий бот можно запустить командой `./gradlew bootRun`

## Локальное хостирование бота

Для локального хостирования бота можно воспользоваться [ngrok.io](https://ngrok.io). Необходимо:

1. Запустить приложение Ngrok
2. Запустить Ngrok командой `ngrok http <port>`, в качестве значения `port` необходимо использовать порт приложения бота
3. Скопировать сгенерированную ссылку из Forwarding и вставить её как значение в `webhook-path`
4. Запустить приложение бота

## Запуск без PostgreSQL

Под стандартным профилем бот подключается к PostgreSQL (к базе данных `logbot_bot_db`). Для того, чтобы запустить бота с
базой данных H2 (в оперативной памяти), необходимо использовать профиль `dev`.